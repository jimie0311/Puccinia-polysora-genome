#Scripts used for Figure 2A (Genomic features inlucding chromosomes, repeats denisity, gene density, candidate effector density and GC content) 
#The scripts to plot hapA and hapB are very similar, here take hapA as an example.

install.packages("circlize")
install.packages("BiocManager") 
install.packages("readxl") 
BiocManager::install("ComplexHeatmap") 
#setwd("/PATH/to/circlize/") 
library(circlize) 
library(ComplexHeatmap) 
library(readxl)

##genome initialization 
cytoband.df <- read.table(file = "hapA.chr", header = F, colClasses = c("character", "numeric", "numeric"),sep = "\t") 
circos.par(start.degree = 0, gap.after = c(rep(1,17),90), cell.padding = c(0,1,0,1)) 
circos.genomicInitialize(cytoband.df,major.by = 60000000,axis.labels.cex = 0.4par("cex"),labels.cex = 0.6par("cex")) 
chrcolor = rep(c("#E3170D")) 
circos.genomicTrackPlotRegion(cytoband.df,ylim=c(0,0.1),track.height=0.03,bg.col=chrcolor,bg.lwd=0.4,cell.padding=c(0.01, 0.5, 0.01, 0.5),track.margin=c(0, 0))

#TE denisity 
TE_bed <- read.table("hapA.repeat.bed",header = F) # The load files are limited < 25 Mb, I list top 100 lines of hapA.repeat.bed as an example
TE_denisity <- genomicDensity(TE_bed, window.size = 1e6, count_by = "percent") 
write.csv(TE_denisity, "hapA_TE_denisity_percent.csv") #open hapA_TE_denisity_percent.csv to see the maximum and minimum repeat percentage and set breaks in color_assign accordingly 
color_assign <- colorRamp2(breaks = c(0.7,0.8,0.9,1.0), col =c('#191970','#00BFFF','#FFFACD','#FF4500')) 
circos.genomicTrackPlotRegion(TE_denisity, track.height = 0.10, stack = TRUE, bg.border = NA, panel.fun = function(region, value, ...) { circos.genomicRect(region, value, col = color_assign(value[[1]]), border = NA, ...) } )

##gene denisity
gene_bed <- read.table("hapA.gene.ID",header = T) 
gene_denisity <- genomicDensity(gene_bed, window.size = 1e6,count_by = "number") 
#head(gene_denisity) #open gene_denisity to see the maximum and minimum gene numbers and set breaks in color_assign accordingly 
color_assign <- colorRamp2 (breaks = c(10,60,110,160), col =c('#E6E6FA','#DDA0DD','#7B68EE','#9400D3')) 
circos.genomicTrackPlotRegion( gene_denisity, track.height = 0.10, stack = TRUE, bg.border = NA, panel.fun = function(region, value, ...) { circos.genomicRect(region, value, col = color_assign(value[[1]]), border = NA, ...) } )

#effector denisity 
effector_bed <- read.table("hapA.effector.bed", header = F) 
wirte.csv(effector_denisity, "hapA_effector.csv") 
circos.genomicDensity(effector_bed, col = "red", window.size = 1e6, count_by = "number", track.height = 0.1, bg.lwd=0.4)
circos.yaxis(side = "right", labels.cex = 0.5)

#gc plot
# The perl script "circos_create_gc_histogram.pl" was used for hapA.gc
gc_bed <- read.table("hapA.gc", header = F) 
circos.genomicTrack(gc_bed, panel.fun = function (region, value, ...) {circos.genomicPoints(region, value, track.height=0.05, pch = 1, cex =0.005, col="#990033")})
circos.yaxis(side = "right", labels.cex = 0.5)
